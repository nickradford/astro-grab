---
import { Code } from "astro:components";
---

<section id="installation" class="bg-black py-24">
  <div class="mx-auto max-w-2xl px-4 sm:px-6 lg:px-8">
    <h2
      class="mb-16 text-center text-3xl font-bold tracking-wider text-white uppercase"
    >
      Installation
    </h2>

    <div class="space-y-12">
      <div>
        <h3 class="mb-6 text-xl font-bold tracking-wide text-white uppercase">
          1. Install Package
        </h3>
        <div class="relative mb-4 border-2 border-orange-500/50 bg-gray-900">
          <Code
            class="p-4"
            lang="sh"
            id="install-cmd"
            code={`npm install astro-grab`}
          />
          <button
            class="copy-btn absolute top-2 right-2 cursor-pointer border border-orange-500 bg-orange-500 px-3 py-1 text-xs text-white transition-all duration-200 hover:bg-orange-600"
            onclick="copyToClipboard(this, '#install-cmd')">Copy</button
          >
        </div>
        <p class="m-0 text-sm text-gray-400">
          Or use <code
            class="bg-gray-800 px-2 py-1 font-mono text-xs text-white"
            >bun add astro-grab</code
          > with Bun.
        </p>
      </div>

      <div>
        <h3 class="mb-6 text-xl font-bold tracking-wide text-white uppercase">
          2. Add Integration
        </h3>
        <div class="relative mb-4 border-2 border-orange-500/50 bg-gray-900">
          <Code
            id="astro-config"
            lang="js"
            class="p-4"
            code={`// astro.config.mjs
import { defineConfig } from 'astro/config';
import { astroGrab } from 'astro-grab';

export default defineConfig({
  integrations: [
    astroGrab(),
  ],
});

/** Here are the options you can pass to \`astroGrab()\`
{
  enabled: true,        // Enable in dev mode
  holdDuration: 1000,   // Hold time in ms
  contextLines: 4,      // Lines around target
  hue: 30,              // Highlight color (orange)
  toolbar: true,        // Enable dev toolbar
}
*/
`}
          />
          <button
            onclick="copyToClipboard(this, '#astro-config')"
            class="copy-btn absolute top-2 right-2 cursor-pointer border border-orange-500 bg-orange-500 px-3 py-1 text-xs text-white transition-all duration-200 hover:bg-orange-600"
            >Copy</button
          >
        </div>
      </div>

      <div>
        <h3 class="mb-6 text-xl font-bold tracking-wide text-white uppercase">
          3. Start Dev Server
        </h3>
        <div class="relative mb-4 border-2 border-orange-500/50 bg-gray-900">
          <Code id="run-cmd" class="p-4" lang="sh" code={`npm run dev`} />
          <button
            class="copy-btn absolute top-2 right-2 cursor-pointer border border-orange-500 bg-orange-500 px-3 py-1 text-xs text-white transition-all duration-200 hover:bg-orange-600"
            onclick="copyToClipboard(this, '#run-cmd')">Copy</button
          >
        </div>
        <p class="m-0 text-sm text-gray-400">
          Toolbar appears in Astro dev mode.
        </p>
      </div>
    </div>
  </div>
</section>

<script is:inline>
  function copyToClipboard(el, targetSelector) {
    const text = document.querySelector(targetSelector).textContent;

    navigator.clipboard
      .writeText(text)
      .then(() => {
        // Track successful copy based on target
        let eventName = "copy-failed";
        if (targetSelector === "#install-cmd") {
          eventName = "copy-install-cmd";
        } else if (targetSelector === "#astro-config") {
          eventName = "copy-astro-config";
        } else if (targetSelector === "#run-cmd") {
          eventName = "copy-run-cmd";
        }

        if (window.umami) {
          window.umami.track(eventName);
        }

        const button = el;
        const originalText = button.textContent;
        button.textContent = "Copied!";
        button.style.background = "#000";
        button.style.color = "white";

        setTimeout(() => {
          button.textContent = originalText;
          button.style.background = "";
          button.style.color = "";
        }, 2000);
      })
      .catch((error) => {
        // Track failed copy with more specific error type
        let eventName = "copy-failed";
        if (
          error.name === "NotAllowedError" ||
          error.message?.includes("permission")
        ) {
          eventName = "clipboard-permission-denied";
        }
        if (window.umami) {
          window.umami.track(eventName);
        }
      });
  }
</script>
