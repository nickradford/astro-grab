---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.astro";
import Installation from "../components/Installation.astro";
import Card from "../components/Card.astro";
import ShortcutDisplay from "../components/ShortcutDisplay.astro";
import ProgressBar from "../components/ProgressBar.astro";
import WalkthroughSteps from "../components/WalkthroughSteps.astro";

import Footer from "../components/Footer.astro";
---

<Layout title="astro-grab - Visual element targeting for Astro">
  <main>
    <Hero />

    <section class="bg-black py-8 md:py-24">
      <!-- Mobile video -->
      <div
        class="mx-auto block max-w-4xl space-y-4 px-4 text-center sm:px-6 md:hidden lg:px-8"
      >
        <video
          class="mx-auto w-full max-w-2xl rounded-lg"
          autoplay
          muted
          loop
          playsinline
        >
          <source src="/astro-grab-demo-trimmed.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
        <p class="text-sm text-gray-300">(Try the demo on desktop)</p>
      </div>

      <!-- Desktop content -->
      <div
        class="mx-auto hidden max-w-4xl px-4 text-center sm:px-6 md:block lg:px-8"
      >
        <h2
          class="mb-16 text-2xl font-bold tracking-wider text-white uppercase"
        >
          Try <span class="normal-case">astro-grab</span> now
        </h2>

        <ProgressBar />
        <WalkthroughSteps />

        <!-- Fake Terminal -->
        <div class="mx-auto max-w-2xl">
          <div
            class="rounded-lg border border-gray-700 bg-gray-900 p-6 font-mono text-sm text-green-400"
          >
            <div class="mb-4 flex items-center">
              <div class="mr-2 h-3 w-3 rounded-full bg-red-500"></div>
              <div class="mr-2 h-3 w-3 rounded-full bg-yellow-500"></div>
              <div class="mr-2 h-3 w-3 rounded-full bg-green-500"></div>
              <span class="text-xs text-gray-400">agent@astro-grab</span>
            </div>
            <div class="space-y-4 text-left">
              <div>
                <span class="font-bold text-green-400">Clog:</span>
                <span class="ml-2 text-gray-300"
                  >What's next on your plate?</span
                >
              </div>
              <div class="rounded bg-gray-800 p-3">
                <textarea
                  id="code-input"
                  class="w-full resize-none overflow-hidden border-none bg-transparent font-mono text-sm text-gray-300 placeholder-gray-500 outline-none"
                  rows="6"
                  placeholder="// Paste your copied component code here"
                ></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <Installation />
  </main>

  <Footer />

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const textarea = document.getElementById("code-input");
      let hasPasted = false;
      let integrationViewed = false;

      // Auto-expand textarea on input
      if (textarea) {
        textarea.addEventListener("input", function () {
          this.style.height = "auto";
          this.style.height = this.scrollHeight + "px";
        });

        // Dispatch paste event when content is added
        const handleInput = () => {
          if (
            (textarea as HTMLTextAreaElement).value.trim().length > 0 &&
            !hasPasted
          ) {
            hasPasted = true;
            window.dispatchEvent(new CustomEvent("demo:text-pasted"));
          }
        };
        textarea.addEventListener("input", handleInput);
      }

      // Focus textarea when walkthrough requests it
      window.addEventListener("walkthrough:focus-textarea", () => {
        if (textarea) textarea.focus();
      });

      // Track integration section visibility
      const integrationSection = document.getElementById("installation");
      if (integrationSection && (window as any).IntersectionObserver) {
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting && !integrationViewed) {
                integrationViewed = true;
                if ((window as any).umami) {
                  (window as any).umami.track("integration-attempted");
                }
              }
            });
          },
          { threshold: 0.1 },
        );
        observer.observe(integrationSection);
      }
    });
  </script>
</Layout>
